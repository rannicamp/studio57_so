<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Funcionário - Studio 57</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script defer src="/__/firebase/10.12.2/firebase-app.js"></script>
    <script defer src="/__/firebase/10.12.2/firebase-auth.js"></script>
    <script defer src="/__/firebase/10.12.2/firebase-firestore.js"></script>
    <script defer src="/__/firebase/10.12.2/firebase-storage.js"></script>
    <script defer src="/__/firebase/init.js"></script>
</head>
<body>
    <div class="page-wrapper">
        <div id="sidebar-placeholder"></div>
        <div class="main-content-area-wrapper">
            <header class="main-header">
                <h1 id="page-title-header">Funcionários</h1>
                <div class="header-user-info">
                    <div id="user-info">Usuário: <span class="font-semibold">Carregando...</span></div>
                    <div id="current-datetime">--/--/---- --:--:--</div>
                    <button id="logout-button-header" title="Sair"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </header>
            <main class="content-scrollable">
                <div class="toast-container" id="toastContainer"></div>
                <div class="spinner-overlay" id="loadingSpinner"><div class="spinner"></div></div>

                <div class="form-container">
                    <div class="form-header">
                        <h3 class="form-title" id="formSectionMainTitle">Novo Funcionário</h3>
                        <p class="form-subtitle">Preencha os dados abaixo. Campos com * são obrigatórios.</p>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-tab="pessoal">Dados Pessoais</div>
                        <div class="tab" data-tab="endereco">Endereço</div>
                        <div class="tab" data-tab="profissional">Dados Profissionais</div>
                        <div class="tab" data-tab="financeiro">Dados Financeiros</div>
                        <div class="tab" data-tab="documentos">Documentos</div>
                    </div>

                    <form id="employeeForm" class="form-body">
                        <input type="hidden" id="employeeId">
                        <input type="hidden" id="originalCpf">
                        <input type="hidden" id="fotoFuncionarioUrl">
                        <input type="hidden" id="fotoFuncionarioPath">
                        <input type="hidden" id="contratoFuncionarioUrl">
                        <input type="hidden" id="contratoFuncionarioPath">
                        <input type="hidden" id="identidadeFuncionarioUrl">
                        <input type="hidden" id="identidadeFuncionarioPath">
                        <input type="hidden" id="asoFuncionarioUrl">
                        <input type="hidden" id="asoFuncionarioPath">

                        <section class="form-section active" data-tab-content="pessoal">
                            <div class="personal-info-grid">
                                <div class="form-group">
                                    <label class="form-label">Foto</label>
                                    <div class="photo-upload-container">
                                        <img id="photoPreview" src="https://via.placeholder.com/120" alt="Prévia da foto" class="photo-preview-form">
                                        <input type="file" id="fotoFuncionarioFile" class="form-control" accept="image/*">
                                        <div id="currentPhotoName" class="file-info-text">Nenhum arquivo selecionado.</div>
                                    </div>
                                </div>
                                <div class="form-grid-2-col">
                                    <div class="form-group">
                                        <label for="nomeCompleto" class="form-label">Nome Completo *</label>
                                        <input type="text" id="nomeCompleto" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" id="email" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="cpf" class="form-label">CPF *</label>
                                        <input type="text" id="cpf" class="form-control" required placeholder="000.000.000-00" maxlength="14">
                                    </div>
                                    <div class="form-group">
                                        <label for="rg" class="form-label">RG</label>
                                        <input type="text" id="rg" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                                        <input type="date" id="dataNascimento" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="telefone" class="form-label">Telefone / Celular</label>
                                        <input type="tel" id="telefone" class="form-control" placeholder="(00) 00000-0000" maxlength="15">
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="form-section" data-tab-content="endereco">
                             <div class="form-grid-2-col">
                                <div class="form-group">
                                    <label for="cep" class="form-label">CEP</label>
                                    <input type="text" id="cep" class="form-control" placeholder="00000-000" maxlength="9">
                                </div>
                                <div class="form-group">
                                    <label for="logradouro" class="form-label">Logradouro (Rua, Av.)</label>
                                    <input type="text" id="logradouro" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="numero" class="form-label">Número</label>
                                    <input type="text" id="numero" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="complemento" class="form-label">Complemento</label>
                                    <input type="text" id="complemento" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="bairro" class="form-label">Bairro</label>
                                    <input type="text" id="bairro" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="cidade" class="form-label">Cidade</label>
                                    <input type="text" id="cidade" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="estado" class="form-label">Estado</label>
                                    <input type="text" id="estado" class="form-control">
                                </div>
                            </div>
                        </section>

                        <section class="form-section" data-tab-content="profissional">
                            <div class="form-grid-2-col">
                                <div class="form-group">
                                    <label for="cargo" class="form-label">Cargo *</label>
                                    <input type="text" id="cargo" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="dataAdmissao" class="form-label">Data de Admissão *</label>
                                    <input type="date" id="dataAdmissao" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="idRelogioPonto" class="form-label">ID no Relógio de Ponto</label>
                                    <input type="text" id="idRelogioPonto" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="observacoes" class="form-label">Observações</label>
                                <textarea id="observacoes" class="form-control" rows="3"></textarea>
                            </div>
                        </section>
                        
                        <section class="form-section" data-tab-content="financeiro">
                            <div class="form-grid-2-col">
                                <div class="form-group">
                                    <label for="salarioBase" class="form-label">Salário Base</label>
                                    <input type="text" id="salarioBase" class="form-control" placeholder="R$ 0,00">
                                </div>
                                <div class="form-group">
                                    <label for="valorDia" class="form-label">Valor da Diária</label>
                                    <input type="text" id="valorDia" class="form-control" placeholder="R$ 0,00">
                                </div>
                                <div class="form-group">
                                    <label for="formaPagamento" class="form-label">Forma de Pagamento</label>
                                    <select id="formaPagamento" class="form-control">
                                        <option value="">Selecione</option>
                                        <option value="PIX">PIX</option>
                                        <option value="DEPOSITO_BANCARIO">Depósito Bancário</option>
                                        <option value="DINHEIRO">Dinheiro</option>
                                    </select>
                                </div>
                            </div>
                            <div id="chavePixContainer" class="form-group" style="display: none;">
                                <label for="chavePix" class="form-label">Chave PIX</label>
                                <input type="text" id="chavePix" class="form-control">
                            </div>
                            <div id="dadosBancariosContainer" class="form-group" style="display: none;">
                                <label for="dadosBancarios" class="form-label">Dados Bancários (Banco, Agência, Conta)</label>
                                <textarea id="dadosBancarios" class="form-control" rows="2"></textarea>
                            </div>
                        </section>
                        
                        <section class="form-section" data-tab-content="documentos">
                            <div class="form-grid-2-col">
                                <div class="form-group">
                                     <label for="contratoFuncionarioFile" class="form-label">Contrato de Trabalho (PDF)</label>
                                    <input type="file" id="contratoFuncionarioFile" class="form-control" accept=".pdf">
                                    <div id="currentContratoName" class="file-info-text">Nenhum arquivo selecionado.</div>

                                    <label for="identidadeFuncionarioFile" class="form-label mt-4">Documento de Identidade (PDF/Imagem)</label>
                                    <input type="file" id="identidadeFuncionarioFile" class="form-control" accept=".pdf,image/*">
                                    <div id="currentIdentidadeName" class="file-info-text">Nenhum arquivo selecionado.</div>

                                    <label for="asoFuncionarioFile" class="form-label mt-4">Exame ASO (PDF/Imagem)</label>
                                    <input type="file" id="asoFuncionarioFile" class="form-control" accept=".pdf,image/*">
                                    <div id="currentAsoName" class="file-info-text">Nenhum arquivo selecionado.</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Status dos Documentos</label>
                                    <div class="form-check">
                                        <input type="checkbox" id="documentosPendentes" class="form-check-input">
                                        <label for="documentosPendentes" class="form-check-label">Marcar se houver documentos pendentes</label>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </form>
                    
                    <div class="form-footer">
                        <button type="button" class="btn btn-outline-form" id="cancelFormBtnFooter">Limpar / Cancelar</button>
                        <button type="submit" form="employeeForm" class="btn btn-success-form" id="saveEmployeeBtnFooter">
                            <i class="fas fa-save"></i>
                            <span id="saveEmployeeBtnFooterText">Salvar Funcionário</span>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        import { app } from './js/firebase-config.js';
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
        import { checkAuthAndRedirect, initializeCommonUI, loadHTMLComponent, initializeSidebarToggle } from './js/common.js';
        import { initializeFuncionarioModule } from './js/funcionario.js';

        async function initializePage() {
            await loadHTMLComponent('sidebar-placeholder', 'sidebar.html');
            const auth = getAuth(app);
            const db = getFirestore(app);
            const storage = getStorage(app);
            
            checkAuthAndRedirect(auth, 'index.html', (user) => {
                initializeCommonUI(user);
                initializeSidebarToggle();
                initializeFuncionarioModule(db, auth, storage);

                const tabs = document.querySelectorAll('.tab');
                const sections = document.querySelectorAll('.form-section');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabTarget = tab.dataset.tab;

                        tabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');

                        sections.forEach(section => {
                            if (section.dataset.tabContent === tabTarget) {
                                section.classList.add('active');
                            } else {
                                section.classList.remove('active');
                            }
                        });
                    });
                });
            });
        }

        initializePage();
    </script>
</body>
</html>